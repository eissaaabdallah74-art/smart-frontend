<section class="bg-page">
  <div class="bg-card">
    <!-- Header -->
    <div class="bg-header">
      <div class="bg-header-main">
        <h1 class="bg-title">
          Security Background Check
          <span class="bg-count">({{ filteredRows().length }})</span>
        </h1>
        <p class="bg-subtitle">
          Couriers with HR feedback = Signed, and their security background result.
        </p>
      </div>

      <div class="bg-header-actions"></div>
    </div>

    <!-- Filters -->
    <div class="bg-filters">
      <div class="filter-group filter-group--wide">
        <label for="bgSearch" class="field-label">Search</label>
        <input
          id="bgSearch"
          type="text"
          class="field-input"
          placeholder="Search by name, ID, phone, residence, hub, area, account, HR / security status..."
          [ngModel]="search()"
          (ngModelChange)="onSearchChange($event)"
        />
      </div>

      <div class="filter-group">
        <label for="securityFilter" class="field-label">Security result</label>
        <select
          id="securityFilter"
          class="field-input"
          [ngModel]="securityResultFilter()"
          (ngModelChange)="onSecurityResultFilterChange($event)"
        >
          <option value="">All</option>
          <option value="Positive">Positive</option>
          <option value="Negative">Negative</option>
          <option value="pending">Pending</option>
        </select>
      </div>
    </div>

    <!-- Table header -->
    <div class="table-header">
      <div class="table-info">
        Showing
        <ng-container *ngIf="filteredRows().length > 0; else emptyRange">
          {{ startIndex() + 1 }}-{{ endIndex() }}
        </ng-container>
        <ng-template #emptyRange>0-0</ng-template>
        of {{ filteredRows().length }} records
      </div>

      <div class="table-actions">
        <div class="page-size-selector">
          <label for="pageSize" class="page-size-label">Show:</label>
          <select
            id="pageSize"
            class="page-size-select"
            [ngModel]="pageSize()"
            (ngModelChange)="onPageSizeChange($event)"
          >
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Table -->
    <div class="table-wrapper">
      <table class="bg-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Courier</th>
            <th>National ID</th>
            <th>Phone</th>
            <th>Company</th>
            <th>Security result</th>
            <th>Notes</th>
            <th class="th-actions">Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let row of paginatedRows(); trackBy: trackById" class="row">
            <td>{{ row.date || "—" }}</td>
            <td class="cell-primary">{{ row.courierName || "—" }}</td>
            <td class="cell-mono">{{ row.nationalId || "—" }}</td>
            <td>{{ row.phoneNumber || "—" }}</td>
            <td>{{ row.account || "—" }}</td>

            <td>
              <span
                class="status-pill status-pill--strong"
                [ngClass]="statusPillClass(row.securityResult)"
              >
                {{ row.securityResult || "Pending" }}
              </span>
            </td>

            <!-- Notes: العين تفتح Interview Details بدل modal -->
            <td class="notes-cell">
              <div class="notes-preview-wrap">
                <span class="notes-preview-multiline">
                  {{ row.notes || "—" }}
                </span>

                <button
                  *ngIf="row.notes && row.notes.trim()"
                  type="button"
                  class="icon-action icon-action--view-notes"
                  title="Open details (notes)"
                  (click)="openDetails(row, 'notes')"
                >
                  <i class="ri-eye-line" aria-hidden="true"></i>
                  <span class="sr-only">Open details (notes)</span>
                </button>
              </div>
            </td>

            <!-- Actions: Details + Edit -->
            <td class="cell-actions">
              <button
                type="button"
                class="icon-action icon-action--details"
                title="Open details"
                (click)="openDetails(row)"
              >
                <i class="ri-external-link-line" aria-hidden="true"></i>
                <span class="sr-only">Open details</span>
              </button>

              <button
                type="button"
                class="icon-action icon-action--edit"
                title="Update security result"
                (click)="openEditModal(row)"
              >
                <i class="ri-edit-line" aria-hidden="true"></i>
                <span class="sr-only">Update security result</span>
              </button>
            </td>
          </tr>

          <tr *ngIf="filteredRows().length === 0">
            <td class="empty-cell" colspan="8">
              No records match your search.
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages() > 1">
      <div class="pagination-info">
        Page {{ currentPage() }} of {{ totalPages() }}
      </div>

      <div class="pagination-controls">
        <button class="pagination-btn" [disabled]="currentPage() === 1" (click)="goToPage(1)">
          <i class="ri-skip-left-line"></i>
        </button>

        <button class="pagination-btn" [disabled]="currentPage() === 1" (click)="previousPage()">
          <i class="ri-arrow-left-line"></i>
        </button>

        <div class="pagination-pages">
          <button
            *ngFor="let page of visiblePages()"
            class="pagination-page"
            [class.active]="page === currentPage()"
            (click)="goToPage(page)"
          >
            {{ page }}
          </button>
        </div>

        <button class="pagination-btn" [disabled]="currentPage() === totalPages()" (click)="nextPage()">
          <i class="ri-arrow-right-line"></i>
        </button>

        <button class="pagination-btn" [disabled]="currentPage() === totalPages()" (click)="goToPage(totalPages())">
          <i class="ri-skip-right-line"></i>
        </button>
      </div>
    </div>
  </div>

<!-- Edit modal component -->
<app-form-modal-security-background-check
  *ngIf="isEditModalOpen && editingInterview"
  [interviewToEdit]="editingInterview"
  [saving]="saving"
  [errorMessage]="errorMessage"
  (close)="closeEditModal()"
  (submit)="onSave($event)"
></app-form-modal-security-background-check>



</section>
